---
title: Deploying Service Mesh (Beta)
owner: CF Networking Service Mesh
---

This topic describes how to deploy service mesh for Pivotal Application Service (PAS).

For more information about service mesh, see [Service Mesh (Beta)](../adminguide/service-mesh.html).


## <a id="configuring-pas"></a> Enable in PAS

To deploy service mesh, configure PAS as follows:

1. Select **Networking - Service Mesh** in the PAS tile. 
	![The page header says 'Networking Service Mesh (Beta)'. Below this header is the text 'For help configuring these fields, see the Configure Networking - Service Mesh (Beta) section of the Configuring PAS topic in the PCF documentation,' with 'Configure Networking - Service Mesh (Beta)' in blue letters to denote a clickable link. Below this text is the text 'Service mesh (beta)', with a red asterisk to denote that it is a required configuration. Below this are two radio buttons: a selected radio button labeled 'Disable', and a radio button labeled 'Enable'. Next are two fields labeled 'IP addresses for Istio router' and 'External domain'. Next is the subheader 'Istio router TLS keypairs', with a dark gray, rectangular button labeled 'Add' to the far right of the subheader. Below the subheader is a dark gray triangle pointing downward, denoting an expandable and collapsable set of fields. To the far right of this triangle, beneath the 'Add' button, is a gray icon of a trashcan. Below the triangle button is a field labeled 'Name', with a red asterisk. Next is a set of two text areas labeled 'Certificate and private key for Istio router', with a red asterisk. The first text area contains the ghost text 'Certificate PEM', and the second text area contains the ghost text 'Private Key PEM'. Below 'Private Key PEM' is the blue clickable text 'Generate RSA Certificate', and beneath 'Generate RSA Certificate' is the text 'Private keys and certificates in PEM block format used for TLS handshakes with clients.'](servicemesh.png)

1. Under **Service mesh (beta)**, select **Enable**. 

1. For **IP addresses for Istio router**, do the following depending on your IaaS:
	* **vSphere**: Enter static IPs for the Istio routers. You must configure your load balancer with these IPs as well. 
	* **Other**: Leave this field blank. 

1. For **External domain**, enter the domain for Istio routers, the default domain is `mesh.app-domain.com`.

1. For **Istio router TLS keypairs**, complete the following fields. You can add more than one keypair if desired using the **Add** button.
	* **Name**: Enter a name for the keypair. 
	* **Certificate and private key for Istio router**: Enter the private key and certificate for TLS handshakes with clients. These must be in PEM block format. 

1. Click **Save**. 


## <a id="create-load-balancer"></a> Create a Load Balancer

To configure a load balancer for service mesh, do the following. The exact procedure varies by IaaS. 

1. Create a load balancer with:
	* A static IP
	* Health check port 8002 and path `/healthcheck`
	* Firewall rules to allow the following:
		* HTTP on port 80
		* HTTP on port 8002
		* TLS on port 443

1. Navigate to your DNS provider and create a DNS name, `*.mesh.YOUR-CF-APPS-DOMAIN`, that resolves to the IP of the load balancer. This is the default domain for service mesh and is not configurable.  


## <a id="resource-config"></a> Add Load Balancer to Resource Config

If your deployment is on an IaaS other than vSphere, do the following after you create your load balancer:

1. Select **Resource Config** in the PAS tile. 

1. In the **Load Balancer** column of the **istio-router** row, enter the name of the load balancer you created. 

1. Click **Apply Changes**. 
